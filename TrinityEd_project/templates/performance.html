{% extends "base.html" %}
{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance | TrinityEd</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
  body {
    background: linear-gradient(135deg,#f0f4ff,#e6f0ff,#fefefe);
    background-size:300% 300%;
    animation: gradientShift 20s ease infinite;
    font-family:'Inter', system-ui, sans-serif;
    scroll-behavior:smooth;
  }
  @keyframes gradientShift {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  /* macOS Window */
  .mac-window {
    width: 90%;
    margin: 2rem auto;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    background: #fff;
    transition: all 0.3s ease;
  }
  .mac-header {
    background: #f1f1f1;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .mac-btn {
    width: 14px; height: 14px;
    border-radius: 50%;
    display: inline-block;
    cursor: pointer;
  }
  .mac-btn.red { background: #ff5f57; }
  .mac-btn.yellow { background: #ffbd2f; }
  .mac-btn.green { background: #28c840; }

  /* Cards */
  .card{
    transition: all 0.5s ease, transform 0.5s ease;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(14px);
    border-radius:18px;
    padding:2rem;
    border:1px solid rgba(37,99,235,0.15);
    cursor:pointer;
    opacity:0; transform:translateY(20px);
    animation: fadeUp 0.8s forwards;
  }
  .card:nth-child(1){animation-delay:0.1s;}
  .card:nth-child(2){animation-delay:0.3s;}
  .card:nth-child(3){animation-delay:0.5s;}
  .card:nth-child(4){animation-delay:0.7s;}
  .card:nth-child(5){animation-delay:0.9s;}
  .card:hover{
    transform:translateY(-12px) scale(1.08);
    box-shadow:0 25px 60px rgba(37,99,235,0.25);
  }
  @keyframes fadeUp{to{opacity:1; transform:translateY(0);}}

  /* Stat values */
  .stat-value{
    font-size:2.2rem; font-weight:700;
    display:inline-block; transition: all 0.4s ease;
  }
  .stat-value:hover{
    transform:scale(1.2);
    color:#1d4ed8;
    animation: pulse 1s infinite;
  }
  @keyframes pulse{
    0%{transform:scale(1.2)}
    50%{transform:scale(1.25)}
    100%{transform:scale(1.2)}
  }

  /* Progress Bars */
  .progress-container{margin-top:0.8rem; background:#e5e7eb; border-radius:9999px; overflow:hidden; height:10px;}
  .progress-bar{height:100%; border-radius:9999px; transition:width 1.5s ease-in-out;}
  .progress-bar-blue{background:#2563eb;}
  .progress-bar-green{background:#16a34a;}
  .progress-bar-red{background:#dc2626;}

  /* Chart Boxes */
  .chart-container{display:flex; flex-wrap:wrap; gap:1.5rem; margin-top:2rem;}
  .chart-box{
    flex:1; min-width:300px; max-width:500px;
    transition: transform 0.35s ease, box-shadow 0.35s ease;
    border-radius:18px; overflow:hidden;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(14px);
    border:1px solid rgba(37,99,235,0.15);
    padding:1.5rem;
    opacity:0; transform:translateY(20px);
    animation: fadeUpChart 0.8s forwards;
  }
  .chart-box:hover{transform:scale(1.03); box-shadow:0 14px 32px rgba(37,99,235,0.28);}
  .chart-box:nth-child(1){animation-delay:0.6s;}
  .chart-box:nth-child(2){animation-delay:0.8s;}
  @keyframes fadeUpChart{to{opacity:1; transform:translateY(0);}}
  </style>
</head>
<body class="flex flex-col min-h-screen bg-cover bg-center bg-fixed relative" 
      style="background-image: url('{% static "img/mentor_wallpaper.webp" %}');">
  
  <!-- optional overlay for contrast -->
  <div class="absolute inset-0 bg-black/20"></div>

  <div id="macWindow" class="mac-window flex flex-col h-[90vh] relative z-10">
    <div class="mac-header">
      <span id="btnClose" class="mac-btn red"></span>
      <span id="btnMinimize" class="mac-btn yellow"></span>
      <span id="btnMaximize" class="mac-btn green"></span>
      <span class="ml-4 font-medium text-gray-600">Performance Dashboard</span>
    </div>

    <!-- MAIN CONTENT -->
    <main id="macContent" class="flex-1 p-6 mb-6 overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-blue-700">Performance Dashboard</h1>
        <button id="exportBtn" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-xl shadow-md hover:scale-105 transition">Export CSV</button>
      </div>

      <!-- Cards -->
      <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
        <div class="card">
          <h3 class="font-semibold text-gray-700 mb-2">Average Score</h3>
          <p class="stat-value text-blue-600">82%</p>
          <div class="progress-container">
            <div class="progress-bar progress-bar-blue" style="width:82%"></div>
          </div>
        </div>
        <div class="card">
          <h3 class="font-semibold text-gray-700 mb-2">Top Student</h3>
          <p class="stat-value text-green-600">Student B</p>
          <div class="progress-container">
            <div class="progress-bar progress-bar-green" style="width:95%"></div>
          </div>
        </div>
        <div class="card">
          <h3 class="font-semibold text-gray-700 mb-2">Needs Improvement</h3>
          <p class="stat-value text-red-600">3 Students</p>
          <div class="progress-container">
            <div class="progress-bar progress-bar-red" style="width:40%"></div>
          </div>
        </div>
        <div class="card">
          <h3 class="font-semibold text-gray-700 mb-2">Highest Score</h3>
          <p class="stat-value text-blue-700">98%</p>
          <div class="progress-container">
            <div class="progress-bar progress-bar-blue" style="width:98%"></div>
          </div>
        </div>
        <div class="card">
          <h3 class="font-semibold text-gray-700 mb-2">Lowest Score</h3>
          <p class="stat-value text-red-700">45%</p>
          <div class="progress-container">
            <div class="progress-bar progress-bar-red" style="width:45%"></div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="chart-container">
        <div class="chart-box">
          <h3 class="text-lg font-semibold mb-4 text-gray-700">Class-wise Average Performance</h3>
          <canvas id="performanceChart"></canvas>
        </div>
        <div class="chart-box">
          <h3 class="text-lg font-semibold mb-4 text-gray-700">Performance Distribution</h3>
          <canvas id="pieChart" height="250"></canvas>
        </div>
      </div>
    </main>
  </div>
<script>
  // macOS Window Controls
  const macWindow = document.getElementById("macWindow");
  const macContent = document.getElementById("macContent");
  const btnClose = document.getElementById("btnClose");
  const btnMinimize = document.getElementById("btnMinimize");
  const btnMaximize = document.getElementById("btnMaximize");

  let isMaximized = false;
  let isMinimized = false;

  // ðŸ”´ Close â†’ hide window
  btnClose.addEventListener("click", () => {
    macWindow.style.display = "none";
  });

  // ðŸŸ¡ Minimize â†’ toggle content visibility based on state
  btnMinimize.addEventListener("click", () => {
    if (!isMinimized) {
      // If maximized, restore to normal with content visible
      if (isMaximized) {
        macWindow.style.position = "static";
        macWindow.style.width = "90%";
        macWindow.style.height = "90vh"; // Consistent height
        macWindow.style.margin = "2rem auto";
        macWindow.style.borderRadius = "14px";
        macContent.style.display = "block"; // Keep content visible
        isMaximized = false;
        return; // Exit after restoring
      }
      // From normal state, hide content
      macContent.style.display = "none";
      macWindow.style.height = "60px"; // Minimum height for header visibility
      macWindow.style.margin = "2rem auto";
    } else {
      // Restore from minimized state
      macContent.style.display = "block";
      macWindow.style.height = "90vh";
      macWindow.style.margin = "2rem auto";
    }
    isMinimized = !isMinimized;
  });

  // ðŸŸ¢ Maximize â†’ toggle fullscreen
  btnMaximize.addEventListener("click", () => {
    if (!isMaximized) {
      macWindow.style.position = "fixed";
      macWindow.style.top = "0";
      macWindow.style.left = "0";
      macWindow.style.width = "100%";
      macWindow.style.height = "100vh";
      macWindow.style.margin = "0";
      macWindow.style.borderRadius = "0";
    } else {
      macWindow.style.position = "static";
      macWindow.style.width = "90%";
      macWindow.style.height = "90vh";
      macWindow.style.margin = "2rem auto";
      macWindow.style.borderRadius = "14px";
    }
    macContent.style.display = "block";
    isMaximized = !isMaximized;
    if (isMaximized) isMinimized = false; // Reset minimized state
  });

  // Bar Chart
  const ctx = document.getElementById('performanceChart').getContext('2d');
  const gradient = ctx.createLinearGradient(0,0,0,300);
  gradient.addColorStop(0,'rgba(37,99,235,0.35)');
  gradient.addColorStop(1,'rgba(37,99,235,0.05)');
  new Chart(ctx,{
    type:'bar',
    data:{
      labels:['Class 1','Class 2','Class 3','Class 4'],
      datasets:[{
        label:'Average Score %',
        data:[78,85,70,90],
        backgroundColor:gradient,
        borderColor:'#2563eb',
        borderWidth:2,
        borderRadius:10,
        hoverBackgroundColor:'#1d4ed8'
      }]
    },
    options:{
      responsive:true,
      scales:{y:{beginAtZero:true,max:100}, x:{grid:{display:false}}},
      plugins:{
        tooltip:{
          callbacks:{
            label:function(ctx){
              let val=ctx.raw;
              if(val<70) return `âš  Needs Improvement: ${val}%`;
              if(val>=70 && val<80) return `âš  Average: ${val}%`;
              return `âœ… Good: ${val}%`;
            }
          }
        },
        legend:{display:false}
      },
      animation:{duration:1500,easing:'easeOutQuart'}
    }
  });

  // Pie Chart
  const pieCtx = document.getElementById('pieChart').getContext('2d');
  new Chart(pieCtx,{
    type:'pie',
    data:{
      labels:['Good','Average','Needs Improvement'],
      datasets:[{
        data:[12,5,3],
        backgroundColor:['#16a34a','#fbbf24','#dc2626'],
        hoverOffset:8
      }]
    },
    options:{
      responsive:true,
      plugins:{tooltip:{callbacks:{label:ctx=>ctx.label+': '+ctx.raw+' Students'}}},
      animation:{animateScale:true,duration:1200,easing:'easeOutQuart'}
    }
  });

  // Export CSV
  document.getElementById('exportBtn').addEventListener('click', function(){
    const cards=document.querySelectorAll('.card');
    const data=Array.from(cards).map(card=>[card.querySelector('h3').innerText,card.querySelector('.stat-value').innerText]);
    data.unshift(['Metric','Value']);
    const csvContent=data.map(e=>e.join(',')).join('\n');
    const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.setAttribute('download','performance.csv');
    link.click();
  });
</script>
</body>
</html>
{% endblock %}